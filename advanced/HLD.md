## 선행
- 세그먼트 트리
- 오일러 투어 트릭

## 연관
- 최소 공통 조상
- 링크/컷 트리

# 헤비-라이트 분할

> 트리의 간선을 세그먼트 트리로 관리할 수 있게 해주는 자료구조

간선이 아니라 정점을 관리할 수도 있으며, 두 정점 사이의 간선 내지 정점들의 정보들을 조회하거나 갱신할 수도 있다. 모든 질의와 쿼리는 $O(log^2N)$ 안에 수행된다.

### 원리와 구성 방법

작동방식은 ETT와 비슷하지만 조금 다르다. DFS 진행 시 가장 깊이가 깊은 노드를 우선적으로 탐색하며, 간선마다 그룹을 나누어서 루트와 꼬리를 기억시킨다. 깊은 노드를 우선적으로 탐색하지 않으면, 최악의 경우 $O(NlogN)$ 시간복잡도가 나올 수 있다.

- 추후 그림 설명 추가

DFS를 총 두어 번 진행한다. 첫 탐색 시에는 단방향 그래프를 구성하면서 노드 별 깊이를 기록한다. 두 번째 탐색 시에는 노드에 새 번호를 부여하면서 각자의 그룹을 기록한다. 이는 해당 노드가 속한 그룹의 루트를 기록하는 것으로 해결할 수 있다. 그리고 각 노드마다 자신의 부모 노드를 기록하면 끝이다.

### 탐색 방법

점 A와 B 사이의 경로에 대해 쿼리를 날리는 방법을 알아본다.

아래의 과정을 거치면 된다.

- 점 A와 B가 같은 그룹에 속할 때까지
  - 점 A와 B 중 깊이가 더 깊은 점을 고른다. 이를 점 C라고 칭한다.
  - 점 C가 속한 그룹의 루트를 구한다. 이를 점 D라고 칭한다.
  - 점 C와 D 사이의 구간을 세그먼트 트리에서 쿼리한다.
  - 점 C에, 점 D의 부모 노드의 값을 적용한다.
- 점 A와 점 B가 같다면, 간선을 쿼리하고 있다면 끝내고, 점을 쿼리하고 있다면 점 하나를 쿼리하고 끝낸다.
- 점 A와 점 B 중, 더 아래에 있는 점을 점 A에 적용하고, 다른 점을 점 B에 적용한다.
- 마지막으로, 간선을 쿼리하고 있다면 A와 B-1 사이의 구간을, 점을 쿼리하고 있다면 A와 B 사이의 구간을 쿼리한다.

### 이모저모

HLD는 간선/정점을 배열로 관리할 수 있게 나누어주는 알고리즘이다. 배열을 관리하는 가장 쉬운 방법은 세그먼트 트리를 쓰는 것이므로, 세그먼트 트리 자료구조를 잘 활용할 줄 알아야 한다.

해당 알고리즘을 이용하면, 꽤 많은 양의 최소 공통 조상 문제들을 HLD로 비틀어 풀 수 있게 된다.

## 연습 문제

- [트리와 쿼리 1[P1]](https://www.acmicpc.net/problem/13510)
- [트리[P1]](https://www.acmicpc.net/problem/13309)
- [남극 탐험[D5]](https://www.acmicpc.net/problem/2927)
- [국제 메시 기구[D4]](https://www.acmicpc.net/problem/17429)